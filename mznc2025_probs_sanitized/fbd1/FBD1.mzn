include "globals.mzn";
int: k;
int: maxn = 5+k^3;
set of int: main_factors = 1..k;
array[main_factors] of var 1..maxn div 2 : n;
var 1..maxn+1: n_star;
array[int] of var int: Q ::output = [2*ni | ni in n];
array[int] of var int: T_plus ::output = [n[j] + n[i] | i,j in main_factors where i < j];
array[int] of var int: T_minus ::output = [n[j] - n[i] | i,j in main_factors where i < j];
array[int] of var int: Q_folded ::output = [2*n[k] + n_star - 2*ni | ni in n];
array[int] of var int: T_plus_folded ::output = [2*n[k] + n_star - t | t in T_plus];
var int: N ::output = 2*n[k] + n_star;
constraint forall([n[i] < n[i+1] | i in main_factors where i < k]);
any: all_elements = n ++ T_minus ++ T_plus ++ Q ++ T_plus_folded ++ Q_folded;
constraint alldifferent(all_elements);
constraint n_star <= 2*n[k] + 1;
constraint forall([n[i] >= i | i in main_factors]);
constraint forall([Q[i] >= 2*i | i in main_factors]);
constraint forall([n[j] != Q[i] | i,j in main_factors where i < j]);
constraint forall([n[j] != 3*n[i] | i,j in main_factors where i < j]);
var int: objective = N;
solve :: int_search(n ++ [n_star], smallest, indomain_min) minimize objective;